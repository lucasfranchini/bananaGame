(()=>{"use strict";class t{constructor(t,e,s,i,r,a,n){this.context=e,this._x=s,this._y=i,this._speedX=0,this._speedY=0,this._img=new Image(a,n),this._img.src=r,this._canvas=t}draw(){const t=this._img.width,e=this._img.height;this.context.drawImage(this._img,this._x,this._y,t,e)}move(){this._x+=this._speedX,this._y+=this._speedY}get y(){return this._y}get x(){return this._x}get img(){return this._img}}class e extends t{constructor(t,e,s){super(t,e,0,0,s,67,67),this._x=this.generateRandomXPosition()}generateRandomXPosition(){return Math.floor(Math.random()*(this._canvas.width-this._img.width))}isOutOfScreen(){return this._y>this._canvas.height-25}}class s extends e{constructor(t,e){super(t,e,"/assets/bomb.png"),this._speedY=12}updateState(t){this.move(),this.isOutOfScreen()&&t.deleteDropable(this),t.player.checkCollision(this)&&(t.player.reduceLife(!0),t.updateLife())}}class i extends e{constructor(t,e){super(t,e,"/assets/orange.png"),this._isBanana=!1,this.chooseRandomFruit()}chooseRandomFruit(){const t=Math.random();t<.3?this.generateFruit("/assets/orange.png",65,!1,5,5):t<.6?this.generateFruit("/assets/red-apple.png",65,!1,8,10):t<.8?this.generateFruit("/assets/watermelon.png",82,!1,11,20):t<.95?this.generateFruit("/assets/strawberry.png",65,!1,14,30):this.generateFruit("/assets/banana.png",61,!0,15,1)}generateFruit(t,e,s,i,r){this._img.src=t,this._img.width=e,this._isBanana=s,this._speedY=i,this._points=r}updateState(t){this.move(),this.isOutOfScreen()&&(t.deleteDropable(this),t.player.reduceLife(!1),t.updateLife()),t.player.checkCollision(this)&&(this._isBanana?t.updateScore(2*t.score):t.updateScore(t.score+this._points),t.deleteDropable(this))}}class r extends t{constructor(t,e,s,i,r){super(t,e,s,i,"/assets/alien.png",64,97),this._maxLife=r,this._actualLife=r,this._x-=64,this._y-=97}updateState(){this.move(),this.stopOnEdge()}startMove(t){"ArrowRight"===t.key?this._speedX=15:"ArrowLeft"===t.key&&(this._speedX=-15)}endMove(t){"ArrowRight"===t.key&&this._speedX>0&&(this._speedX=0),"ArrowLeft"===t.key&&this._speedX<0&&(this._speedX=0)}stopOnEdge(){this._x<0&&(this._x=0),this._x+this._img.width>this._canvas.width&&(this._x=this._canvas.width-this._img.width)}checkCollision(t){const e={y:[this._y,this._y+this._img.height],x:[this._x,this._x+this._img.width]},s={y:[t.y,t.y+t.img.height],x:[t.x,t.x+t.img.width]};return this.collisionOnLeft(e,s)||this.collisionOnRight(e,s)||this.collisionOnCenter(e,s)}collisionOnRight(t,e){return e.x[0]>t.x[0]&&e.x[0]<t.x[1]&&e.y[1]>t.y[0]}collisionOnLeft(t,e){return e.x[1]>t.x[0]&&e.x[1]<t.x[1]&&e.y[1]>t.y[0]}collisionOnCenter(t,e){return e.x[0]<t.x[0]&&e.x[1]>t.x[1]&&e.y[1]>t.y[0]}reduceLife(t){t?this._actualLife=0:this._actualLife--}checkLife(){return 0===this.actualLife}get maxLife(){return this._maxLife}get actualLife(){return this._actualLife}}const a=window.innerWidth,n=window.innerHeight,h=document.querySelector("#canvas"),o=new class{constructor(t,e,s){this._canvas=s,this._canvas.width=t,this._canvas.height=e,this._context=s.getContext("2d")}start(){this._player=new r(this._canvas,this._context,this._canvas.width/2,this._canvas.height-25,4),this._dropables=[],this._difficult=1,this.scoreInHeader(),this.updateScore(0),this.updateLife(),this.clearIntervals(),this._gameIntervalId=window.setInterval((()=>this.loop()),1e3/60),this._fruitsIntervalId=window.setInterval((()=>this.spawnFruit()),1e3),this._bombsIntervalId=window.setInterval((()=>this.spawnBomb()),2e3),this._difficultIntervalId=window.setInterval((()=>this.increaseDificult()),5e3)}updateScore(t){const e=document.querySelector(".score");t-this.score>0&&(e.classList.add("highlight"),setTimeout((()=>e.classList.remove("highlight")),100)),this.score=t,e.innerText="Score: "+this.score}updateLife(){const t=document.querySelector(".lifes");t.innerHTML="";for(let e=0;e<this.player.maxLife;e++){const s=new Image(40,40);e>=this.player.actualLife?s.src="/assets/heart-empty.png":s.src="/assets/heart.png",t.appendChild(s)}}spawnFruit(){this._dropables.push(new i(this._canvas,this._context))}spawnBomb(){this._dropables.push(new s(this._canvas,this._context))}loop(){this._player.updateState(),this._dropables.forEach((t=>t.updateState(this))),this.player.checkLife()&&this.end(),this.renderGame()}renderGame(){this.clearScreen(),this._player.draw(),this._dropables.forEach((t=>t.draw()))}increaseDificult(){this._difficult<3&&(this._difficult+=.5),clearInterval(this._fruitsIntervalId),this._fruitsIntervalId=window.setInterval((()=>this.spawnFruit()),1e3/this._difficult)}deleteDropable(t){this._dropables=this._dropables.filter((e=>e!==t))}clearScreen(){this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}onKeyDown(t){if("Enter"===t.key)return this.start();this._player.startMove(t)}onKeyUp(t){this._player.endMove(t)}end(){this._dropables=[],this.clearIntervals(),this.scoreCentered()}scoreCentered(){const t=document.querySelector(".score");t.classList.add("End");const e=document.createElement("span");e.innerText="Press Enter to restart",t.appendChild(e)}scoreInHeader(){document.querySelector(".score").classList.remove("End")}clearIntervals(){clearInterval(this._gameIntervalId),clearInterval(this._fruitsIntervalId),clearInterval(this._bombsIntervalId),clearInterval(this._difficultIntervalId)}get player(){return this._player}}(a,n,h);o.start(),window.addEventListener("keyup",(t=>{o.onKeyUp(t)})),window.addEventListener("keydown",(t=>{o.onKeyDown(t)}))})();